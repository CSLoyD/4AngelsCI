var base_url=$('input[name="base_url"]').val();function usersTable(filter="all"){$("#tbl_users").DataTable({processing:!0,serverSide:!0,responsive:!0,destroy:!0,order:[[0,"desc"]],columns:[{data:"user_id",width:"10%"},{data:"fullname",width:"18%"},{data:"email",width:"15%"},{data:"user_status",width:"10%",render:function(data,type,row,meta){return str="",1==row.user_type?str+='<span class="label label-danger">Admin</span>':2==row.user_type?str+='<span class="label label-success">Supervisor</span>':str+='<span class="label label-info">Manager</span>',str}},{data:"user_status",width:"8%",render:function(data,type,row,meta){return str="",1==row.user_status?str+='<p class="btn btn-sm btn-outline-success">Enabled</p>':str+='<p class="btn btn-sm btn-outline-danger">Disabled</p>',str}},{data:"user_id",width:"12%",render:function(data,type,row,meta){var str="";return 1==row.user_status?str+='<button data-id="'+row.user_id+'" data-status="'+row.user_status+'" class="btn btn-sm btn-outline-success updateUserStatus" title="Click to enable"><i class="fa fa-unlock"></i> Disable</button>&nbsp;':str+='<button data-id="'+row.user_id+'" data-status="'+row.user_status+'" class="btn btn-sm btn-outline-dark updateUserStatus" title="Click to disable"><i class="fa fa-lock"></i> Enable</button>&nbsp;',str+='<button data-toggle="modal" data-target="#modal_updateUser" data-id="'+row.user_id+'" class="btn btn-sm btn-outline-warning updateUser" title="Click to update"><i class="fa fa-edit"></i> Edit</button>&nbsp;',str+='<button data-id="'+row.user_id+'" class="btn btn-sm btn-outline-danger removeUser" title="Click to remove"><i class="fa fa-times-circle"></i> Remove</button>'}}],language:{search:"",searchPlaceholder:"Search keyword...",infoFiltered:""},ajax:{url:base_url+"users/getUsersList",type:"POST",data:{filter:filter},beforeSend:function(){$(".tableLoad").show(),$(".all_contents").css({opacity:0})},complete:function(){$(".tableLoad").hide(),$(".all_contents").css({opacity:1})}},columnDefs:[{targets:[5],orderable:!1}]})}function sendAjax(param={},isReturn=!0){if(!1===isReturn){var return_response=null;return $.ajax({url:param.url,type:"post",data:param.data,async:!1,processData:!1,contentType:!1,dataType:"json",beforeSend:function(){$(".overlay").show()},success:function(response){$(".overlay").hide(),console.log(response),return_response=response},error:function(e){console.log(e)}}),return_response}var return_data=null;if($.ajax({url:param.url,type:"post",data:param.data,async:!1,dataType:"json",success:function(response){return_data=response},error:function(e){console.log(e)}}),isReturn)return return_data}function confirm_swal(text,confirmBtnText){var isSuccess=!1;return new Promise((function(resolve,reject){Swal.fire({title:"Are you sure?",text:text,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:confirmBtnText}).then(result=>{result.value?resolve(!0):resolve(!1)})}))}function swal(content,response="success"){"success"==response?Swal.fire("Success",content,response):Swal.fire("Error",content,response)}function clearError(){$(".err").html("")}function input(element,value){$(element).val(value)}$(document).ready((function(){usersTable(),$(document).on("submit",".form_addUser",(function(e){e.preventDefault();var form_data=new FormData($(".form_addUser")[0]),sendAjaxVar=sendAjax({url:base_url+"users/addUser",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_addUser")[0].reset(),tbl_users.ajax.reload(),$("#modal_addUser").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("click",".updateUserStatus",(function(){var user_id=$(this).data("id"),user_status=$(this).data("status");1==user_status?confirm_swal("Disable this User?","Disable").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"users/userStatus",data:{user_id:user_id,user_status:user_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_users.ajax.reload())}})):confirm_swal("Enable this User?","Enable").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"users/userStatus",data:{user_id:user_id,user_status:user_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_users.ajax.reload())}}))})),$(document).on("click",".removeUser",(function(e){e.preventDefault();var user_id=$(this).data("id");confirm_swal("Are you sure you want to remove this User?","Remove").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"users/removeUser",data:{user_id:user_id}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_users.ajax.reload())}}))})),$(document).on("click",".updateUser",(function(){user_id=$(this).data("id");var data=sendAjax({url:base_url+"users/getUserInfo",data:{user_id:user_id}});$(".form_updateUser")[0].reset(),input('select[name="upusertype"]',data.user_type),input('input[name="upfirstname"]',data.firstname),input('input[name="uplastname"]',data.lastname),input('input[name="upusername"]',data.username),input('input[name="upemail"]',data.email),input('input[name="tbl_user_id"]',user_id),$(".form_addUser")[0].reset()})),$(document).on("submit",".form_updateUser",(function(e){e.preventDefault();var form_data=new FormData($(".form_updateUser")[0]),sendAjaxVar=sendAjax({url:base_url+"users/updateUser",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_updateUser")[0].reset(),tbl_users.ajax.reload(),$("#modal_updateUser").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("change",".filterType",(function(){usersTable($(this).val())}))}));