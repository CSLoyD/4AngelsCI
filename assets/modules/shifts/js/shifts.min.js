var base_url=$('input[name="base_url"]').val(),method=$('input[name="basemethod"]').val();function shiftsTable(filter="all"){$("#tbl_shifts").DataTable({destroy:!0,processing:!0,serverSide:!0,responsive:!0,pageLength:50,order:[[1,"desc"]],columns:[{data:"schedule_id",width:"10%"},{data:"employeename",width:"20%"},{data:"facility_name",width:"20%"},{data:"schedule_date",width:"20%"},{data:"schedule_status",width:"20%",render:function(data,type,row,meta){var str="";return 2==row.schedule_status?str+='<p class="btn btn-sm btn-outline-primary">Taken</p>':3==row.schedule_status?str+='<p class="btn btn-sm btn-outline-danger">Declined</p>':4==row.schedule_status?str+='<p class="btn btn-sm btn-outline-warning">Close</p>':5==row.schedule_status?str+='<p class="btn btn-sm btn-outline-success">Completed</p>':str+='<p class="btn btn-sm btn-outline-success">Open</p>',str}},{data:"schedule_id",width:"20%",render:function(data,type,row,meta){var str="";return 2==row.schedule_status?(str+='<button data-id="'+row.schedule_id+'" data-status="'+row.schedule_status+'" class="btn btn-sm btn-outline-success updateShiftStatus" title="Approve Shift"><i class="fa fa-check"></i></button>&nbsp;',str+='<button data-id="'+row.schedule_id+'" data-status="'+row.schedule_status+'" class="btn btn-sm btn-outline-danger updateShiftStatus" title="Disapprove Shift"><i class="fa fa-times"></i></button>&nbsp;'):4==row.schedule_status&&(str+='<button data-id="'+row.schedule_id+'" data-status="'+row.schedule_status+'" class="btn btn-sm btn-outline-success updateShiftStatus" title="Open Shift"><i class="fa fa-unlock"></i></button>&nbsp;'),str+='<button data-toggle="modal" data-target="#modal_shiftDetails" data-id="'+row.schedule_id+'" class="btn btn-sm btn-outline-warning shiftDetails" title="Click to view"><i class="fa fa-eye"></i></button>&nbsp;'}}],language:{search:"",searchPlaceholder:"Search Shifts...",infoFiltered:""},ajax:{url:base_url+"shifts/getShifts",type:"POST",data:{filter:filter},beforeSend:function(){$(".tableLoad").show(),$(".all_contents").css({opacity:0})},complete:function(){$(".tableLoad").hide(),$(".all_contents").css({opacity:1})}},columnDefs:[{targets:[0,5],orderable:!1}]})}function sendAjax(param={},isReturn=!0){if(!1===isReturn){var return_response=null;return $.ajax({url:param.url,type:"post",data:param.data,async:!1,processData:!1,contentType:!1,dataType:"json",beforeSend:function(){$(".buttonLoader").show()},success:function(response){$(".buttonLoader").hide(),console.log(response),return_response=response},error:function(e){console.log(e)}}),return_response}var return_data=null;if($.ajax({url:param.url,type:"post",data:param.data,async:!1,dataType:"json",success:function(response){return_data=response},error:function(e){console.log(e)}}),isReturn)return return_data}function confirm_swal(text,confirmBtnText){var isSuccess=!1;return new Promise((function(resolve,reject){Swal.fire({title:"Are you sure?",text:text,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:confirmBtnText}).then(result=>{result.value?resolve(!0):resolve(!1)})}))}function swal(content,response="success"){"success"==response?Swal.fire("Success",content,response):Swal.fire("Error",content,response)}function clearError(){$(".err").html("")}function input(element,value){$(element).val(value)}function customswal(msg){let timerInterval;Swal.fire({title:"Success!",html:"Will close in <b></b>",text:msg,type:"success",confirmButtonColor:"#3085d6",confirmButtonText:"Ok",allowOutsideClick:!1,allowEscapeKey:!1,timer:2e3,timerProgressBar:!0,didOpen:()=>{Swal.showLoading(),timerInterval=setInterval(()=>{const content=Swal.getHtmlContainer();if(content){const b=content.querySelector("b");b&&(b.textContent=(Swal.getTimerLeft()/1e3).toFixed(0))}},100)},willClose:()=>{clearInterval(timerInterval)}}).then(result=>{result&&location.reload()})}$(document).ready((function(){shiftsTable(),$(document).on("click",".updateShiftStatus",(function(){var schedule_id=$(this).data("id"),schedule_status=$(this).data("status");2==schedule_status?confirm_swal("Approve employee shift request?","Enable").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"shifts/updateShiftStatus/"+schedule_status,data:{schedule_id:schedule_id,schedule_status:schedule_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_shifts.ajax.reload())}})):4==schedule_status?confirm_swal("Open employee shift request?","Enable").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"shifts/updateShiftStatus/"+schedule_status,data:{schedule_id:schedule_id,schedule_status:schedule_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_shifts.ajax.reload())}})):confirm_swal("Decline employee shift request?","Disable").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"shifts/updateShiftStatus/"+schedule_status,data:{schedule_id:schedule_id,schedule_status:schedule_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_shifts.ajax.reload())}}))})),$(document).on("change",".filterType",(function(){shiftsTable($(this).val())}))}));