var base_url=$('input[name="base_url"]').val();function attendanceTable(employee="all",date="",time="all"){$("#tbl_attendance").DataTable({destroy:!0,processing:!0,serverSide:!0,responsive:!0,order:[[1,"desc"]],columns:[{data:"employeename",width:"20%"},{data:"date_added",width:"15%"},{data:"clockin_time",width:"15%"},{data:"total_hrs_rendered",width:"10%",render:function(data,type,row,meta){var str="";return 0==row.total_hrs_rendered?str+="<span>Pending</span>":str+=row.total_hrs_rendered+" Hour(s)",str}},{data:"attendance_id",width:"10%",render:function(data,type,row,meta){var str="";return str+='<button data-toggle="modal" data-target="#modal_viewAttendance" data-id="'+row.attendance_id+'" data-employeename="'+row.employeename+'" class="btn btn-sm btn-outline-info viewAttendance" title="Click to view"><i class="fa fa-eye"></i> View</button>&nbsp;',str+='<button data-toggle="modal" data-target="#modal_updateAttendance" data-id="'+row.attendance_id+'" class="btn btn-sm btn-outline-warning updateAttendance" title="Click to update"><i class="fa fa-edit"></i> Edit</button>&nbsp;'}}],language:{search:"",searchPlaceholder:"Search Attendance...",infoFiltered:""},ajax:{url:base_url+"attendance/getAttendance",type:"POST",data:{employee:employee,date:date,time:time},beforeSend:function(){$(".tableLoad").show(),$(".all_contents").css({opacity:0})},complete:function(){$(".tableLoad").hide(),$(".all_contents").css({opacity:1})}},columnDefs:[{targets:[4],orderable:!1}]})}function sendAjax(param={},isReturn=!0){if(!1===isReturn){var return_response=null;return $.ajax({url:param.url,type:"post",data:param.data,async:!1,processData:!1,contentType:!1,dataType:"json",beforeSend:function(){$(".buttonLoader").show()},success:function(response){$(".buttonLoader").hide(),console.log(response),return_response=response},error:function(e){console.log(e)}}),return_response}var return_data=null;if($.ajax({url:param.url,type:"post",data:param.data,async:!1,dataType:"json",success:function(response){return_data=response},error:function(e){console.log(e)}}),isReturn)return return_data}function confirm_swal(text,confirmBtnText){var isSuccess=!1;return new Promise((function(resolve,reject){Swal.fire({title:"Are you sure?",text:text,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:confirmBtnText}).then(result=>{result.value?resolve(!0):resolve(!1)})}))}function swal(content,response="success"){"success"==response?Swal.fire("Success",content,response):Swal.fire("Error",content,response)}function clearError(){$(".err").html("")}function input(element,value){$(element).val(value)}function customswal(msg){let timerInterval;Swal.fire({title:"Success!",html:"Will close in <b></b>",text:msg,type:"success",confirmButtonColor:"#3085d6",confirmButtonText:"Ok",allowOutsideClick:!1,allowEscapeKey:!1,timer:2e3,timerProgressBar:!0,didOpen:()=>{Swal.showLoading(),timerInterval=setInterval(()=>{const content=Swal.getHtmlContainer();if(content){const b=content.querySelector("b");b&&(b.textContent=(Swal.getTimerLeft()/1e3).toFixed(0))}},100)},willClose:()=>{clearInterval(timerInterval)}}).then(result=>{result&&location.reload()})}$(document).ready((function(){attendanceTable(),$(document).on("click",".viewAttendance",(function(){attendance_id=$(this).data("id"),employeename=$(this).data("employeename");var data=sendAjax({url:base_url+"attendance/getAttendanceInfo",data:{attendance_id:attendance_id,type:"view"}});$(".form_viewAttendance")[0].reset(),clearError(),input('input[name="viewemployeename"]',employeename),input('input[name="viewclockin"]',data.clockin_time),input('input[name="viewclockout"]',data.clockout_time),input('input[name="viewdate"]',data.date_added),input('input[name="viewtotalhours"]',data.total_hrs_rendered)})),$(document).on("click",".updateAttendance",(function(){attendance_id=$(this).data("id");var data=sendAjax({url:base_url+"attendance/getAttendanceInfo",data:{attendance_id:attendance_id,type:"update"}});$(".form_updateAttendance")[0].reset(),input('input[name="upattendance_id"]',attendance_id),input('input[name="upclockin"]',data.clockin_time),input('input[name="upclockout"]',data.clockout_time),clearError()})),$(document).on("submit",".form_updateAttendance",(function(e){e.preventDefault();var employee=$('select[name="filterEmployee"]').val(),date=$('input[name="filterDate"]').val(),time=$('select[name="filterTime"]').val(),form_data=new FormData($(".form_updateAttendance")[0]),sendAjaxVar=sendAjax({url:base_url+"attendance/updateAttendance",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_updateAttendance")[0].reset(),attendanceTable(employee,date,time),$("#modal_updateAttendance").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("change",'select[name="filterEmployee"]',(function(){var employee,date,time;attendanceTable($(this).val(),$('input[name="filterDate"]').val(),$('select[name="filterTime"]').val())})),$(document).on("change",'input[name="filterDate"]',(function(){var employee,date,time;attendanceTable($('select[name="filterEmployee"]').val(),$(this).val(),$('select[name="filterTime"]').val())})),$(document).on("change",'select[name="filterTime"]',(function(){var employee,date,time;attendanceTable($('select[name="filterEmployee"]').val(),$('input[name="filterDate"]').val(),$(this).val())}))}));