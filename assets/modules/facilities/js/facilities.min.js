var base_url=$('input[name="base_url"]').val(),method=$('input[name="basemethod"]').val();function sendAjax(param={},isReturn=!0){if(!1===isReturn){var return_response=null;return $.ajax({url:param.url,type:"post",data:param.data,async:!1,processData:!1,contentType:!1,dataType:"json",beforeSend:function(){$(".buttonLoader").show()},success:function(response){$(".buttonLoader").hide(),console.log(response),return_response=response},error:function(e){console.log(e)}}),return_response}var return_data=null;if($.ajax({url:param.url,type:"post",data:param.data,async:!1,dataType:"json",success:function(response){return_data=response},error:function(e){console.log(e)}}),isReturn)return return_data}function confirm_swal(text,confirmBtnText){var isSuccess=!1;return new Promise((function(resolve,reject){Swal.fire({title:"Are you sure?",text:text,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:confirmBtnText}).then(result=>{result.value?resolve(!0):resolve(!1)})}))}function swal(content,response="success"){"success"==response?"Error adding Schedule: Please select days without overlapping a month"===content?Swal.fire("Error",content,"error"):(Swal.fire("Success",content,response),console.log(content),"Schedule Added Successfully"===content&&setTimeout((function(){window.location.reload(1)}),2e3)):Swal.fire("Error",content,response)}function clearError(){$(".err").html("")}function input(element,value){$(element).val(value)}function customswal(msg){let timerInterval;Swal.fire({title:"Success!",html:"Will close in <b></b>",text:msg,type:"success",confirmButtonColor:"#3085d6",confirmButtonText:"Ok",allowOutsideClick:!1,allowEscapeKey:!1,timer:2e3,timerProgressBar:!0,didOpen:()=>{Swal.showLoading(),timerInterval=setInterval(()=>{const content=Swal.getHtmlContainer();if(content){const b=content.querySelector("b");b&&(b.textContent=(Swal.getTimerLeft()/1e3).toFixed(0))}},100)},willClose:()=>{clearInterval(timerInterval)}}).then(result=>{result&&location.reload()})}function renderCalendar(){var calendarEl=document.getElementById("calendar"),facilityID=document.getElementById("facility_id_holder").textContent,getSched=base_url+"facilities/getSchedules/"+facilityID,calendar=new FullCalendar.Calendar(calendarEl,{selectable:!0,unselectAuto:!0,dateClick:function(info){clearError(),$("input[name=Shift_Date]").val(info.dateStr),$("#modal_addSchedule").modal()},select:function(info){var start,end;const dates=[info.startStr,info.endStr];var dateData=dates.map(Date.parse),DateDifference;if(864e5==BigInt(dateData[1])-BigInt(dateData[0]));else{clearError();var str=dateData[1],strToDate=new Date(str),lastDayOfMonth=new Date(strToDate.getFullYear(),strToDate.getMonth()+1,0);lastDayOfMonth=lastDayOfMonth.getDate();var day=strToDate.getDate()-1,year=strToDate.getFullYear(),month=strToDate.getMonth()+1;if(month<10&&(month="0"+month),day<10&&day>0)var endDate=year+"-"+month+"-0"+day;else if(0==day)var endDate=year+"-"+month+"-01";else if(day+1==lastDayOfMonth)var endDate=year+"-"+month+"-"+lastDayOfMonth;else var endDate=year+"-"+month+"-"+day;$("input[name=Start_Date]").val(info.startStr),$("input[name=End_Date]").val(endDate),$("input[name=lastDayofMonth]").val(lastDayOfMonth),$("#modal_addMultiSchedule").modal()}},eventClick:function(info){var schedule_id=info.event._def.publicId,data=sendAjax({url:base_url+"facilities/getScheduleInfo",data:{schedule_id:schedule_id}});$(".form_updateSchedule")[0].reset(),clearError(),input('input[name="upsched_id"]',schedule_id),input('input[name="upShift_Date"]',data.schedule_date),input('input[name="upShift_Time_Start"]',data.time_start),input('input[name="upShift_Time_End"]',data.time_end),$("#removeSchedule").data("id",schedule_id),$("#modal_updateSchedule").modal("toggle")},initialView:"dayGridMonth",headerToolbar:{left:"prev,next today",center:"title",right:""},events:getSched,eventColor:"#6cc1bd",eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!0},displayEventEnd:!0});calendar.destroy(),calendar.render(),calendar.on("dateClick",(function(info){console.log("clicked on "+info.dateStr)}))}$(document).ready((function(){var tbl_shifts=$("#tbl_shifts").DataTable({destroy:!0,processing:!0,serverSide:!0,responsive:!0,pageLength:50,order:[[1,"desc"]],columns:[{data:"schedule_id",width:"10%"},{data:"employeename",width:"20%"},{data:"facility_name",width:"20%"},{data:"schedule_date",width:"20%"},{data:"schedule_status",width:"20%",render:function(data,type,row,meta){var str="";return 2==row.schedule_status?str+='<p class="btn btn-sm btn-outline-primary">Taken</p>':3==row.schedule_status?str+='<p class="btn btn-sm btn-outline-danger">Declined</p>':4==row.schedule_status?str+='<p class="btn btn-sm btn-outline-warning">Close</p>':4==row.schedule_status?str+='<p class="btn btn-sm btn-outline-success">Completed</p>':str+='<p class="btn btn-sm btn-outline-success">Open</p>',str}},{data:"schedule_id",width:"20%",render:function(data,type,row,meta){var str="";return 2==row.schedule_status?(str+='<button data-id="'+row.schedule_id+'" data-status="'+row.schedule_status+'" class="btn btn-sm btn-outline-success updateShiftStatus" title="Approve Shift"><i class="fa fa-check"></i></button>&nbsp;',str+='<button data-id="'+row.schedule_id+'" data-status="'+row.schedule_status+'" class="btn btn-sm btn-outline-danger updateShiftStatus" title="Disapprove Shift"><i class="fa fa-times"></i></button>&nbsp;'):4==row.schedule_status&&(str+='<button data-id="'+row.schedule_id+'" data-status="'+row.schedule_status+'" class="btn btn-sm btn-outline-success updateShiftStatus" title="Open Shift"><i class="fa fa-unlock"></i></button>&nbsp;'),str+='<button data-toggle="modal" data-target="#modal_shiftDetails" data-id="'+row.schedule_id+'" class="btn btn-sm btn-outline-warning shiftDetails" title="Click to view"><i class="fa fa-eye"></i></button>&nbsp;'}}],language:{search:"",searchPlaceholder:"Search Shifts...",infoFiltered:""},ajax:{url:base_url+"facilities/getShifts",type:"POST",beforeSend:function(){$(".tableLoad").show(),$(".all_contents").css({opacity:0})},complete:function(){$(".tableLoad").hide(),$(".all_contents").css({opacity:1})}},columnDefs:[{targets:[0,5],orderable:!1}]});$(document).on("submit",".form_updateSchedule",(function(e){e.preventDefault();var form_data=new FormData($(".form_updateSchedule")[0]),sendAjaxVar=sendAjax({url:base_url+"facilities/updateSchedule",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_updateSchedule")[0].reset(),renderCalendar(),$("#modal_updateSchedule").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("click","#removeSchedule",(function(e){e.preventDefault();var schedule_id=$(this).data("id");confirm_swal("Are you sure you want to remove this Schedule?","Remove").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"facilities/removeSchedule",data:{schedule_id:schedule_id}});sendAjaxVar&&($("#modal_updateSchedule").modal("toggle"),swal(sendAjaxVar.msg,sendAjaxVar.type),renderCalendar())}}))})),$(document).on("click",".updateShiftStatus",(function(){var schedule_id=$(this).data("id"),schedule_status=$(this).data("status");2==schedule_status?confirm_swal("Approve employee shift request?","Enable").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"facilities/updateShiftStatus/"+schedule_status,data:{schedule_id:schedule_id,schedule_status:schedule_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_shifts.ajax.reload())}})):4==schedule_status?confirm_swal("Open employee shift request?","Enable").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"facilities/updateShiftStatus/"+schedule_status,data:{schedule_id:schedule_id,schedule_status:schedule_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_shifts.ajax.reload())}})):confirm_swal("Decline employee shift request?","Disable").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"facilities/updateShiftStatus/"+schedule_status,data:{schedule_id:schedule_id,schedule_status:schedule_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_shifts.ajax.reload())}}))}));var tbl_facilities=$("#tbl_facilities").DataTable({destroy:!0,processing:!0,serverSide:!0,responsive:!0,order:[[1,"asc"]],columns:[{data:"facility_id",width:"15%"},{data:"facility_name",width:"30%",render:function(data,type,row,meta){var str="";return str='<b><a class="facNameHover" href="'+base_url+"facilities/viewScheduleCalendar/"+row.facility_code+"/"+row.facility_id+'">'+row.facility_name+"</a></b>"}},{data:"date_added",width:"15%"},{data:"facility_id",width:"10%",render:function(data,type,row,meta){var str="";return str+='<button data-toggle="modal" data-target="#modal_updateFacility" data-id="'+row.facility_id+'" class="btn btn-sm btn-outline-warning updateFacility" title="Click to update"><i class="fa fa-edit"></i> Edit</button>&nbsp;',str+='<button data-id="'+row.facility_id+'" class="btn btn-sm btn-outline-danger removeFacility" title="Click to remove"><i class="fa fa-times-circle"></i> Remove</button>'}}],language:{search:"",searchPlaceholder:"Search Facility...",infoFiltered:""},ajax:{url:base_url+"facilities/getFacilities",type:"POST",beforeSend:function(){$(".tableLoad").show(),$(".all_contents").css({opacity:0})},complete:function(){$(".tableLoad").hide(),$(".all_contents").css({opacity:1})}},columnDefs:[{targets:[3],orderable:!1}]});$(document).on("click",".addFacility",(function(e){e.preventDefault(),clearError()})),$(document).on("submit",".form_addFacility",(function(e){e.preventDefault();var form_data=new FormData($(".form_addFacility")[0]),sendAjaxVar=sendAjax({url:base_url+"facilities/addFacility",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_addFacility")[0].reset(),tbl_facilities.ajax.reload(),$("#modal_addFacility").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("submit",".form_addSchedule",(function(e){e.preventDefault();var form_data=new FormData($(".form_addSchedule")[0]),sendAjaxVar=sendAjax({url:base_url+"facilities/addSchedule",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$("#modal_addSchedule").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("submit",".form_addMultiSchedule",(function(e){e.preventDefault();var form_data=new FormData($(".form_addMultiSchedule")[0]),sendAjaxVar=sendAjax({url:base_url+"facilities/addMultiSchedule",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$("#modal_addMultiSchedule").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("click",".updateFacility",(function(){facility_id=$(this).data("id");var data=sendAjax({url:base_url+"facilities/getFacilityInfo",data:{facility_id:facility_id}});$(".form_updatefacility")[0].reset(),clearError(),input('input[name="up_facility_id"]',facility_id),input('input[name="facilityname"]',data.facility_name),$(".form_addFacility")[0].reset()})),$(document).on("submit",".form_updatefacility",(function(e){e.preventDefault();var form_data=new FormData($(".form_updatefacility")[0]),sendAjaxVar=sendAjax({url:base_url+"facilities/updateFacility",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_updatefacility")[0].reset(),tbl_facilities.ajax.reload(),$("#modal_updateFacility").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("click",".removeFacility",(function(e){e.preventDefault();var facility_id=$(this).data("id");confirm_swal("Are you sure you want to remove this Facility?","Remove").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"facilities/removeFacility",data:{facility_id:facility_id}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_facilities.ajax.reload())}}))}))})),"viewScheduleCalendar"==method&&renderCalendar();