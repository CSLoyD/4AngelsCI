var base_url=$('input[name="base_url"]').val(),method=$('input[name="basemethod"]').val();function sendAjax(param={},isReturn=!0){if(!1===isReturn){var return_response=null;return $.ajax({url:param.url,type:"post",data:param.data,async:!1,processData:!1,contentType:!1,dataType:"json",beforeSend:function(){$(".buttonLoader").show()},success:function(response){$(".buttonLoader").hide(),console.log(response),return_response=response},error:function(e){console.log(e)}}),return_response}var return_data=null;if($.ajax({url:param.url,type:"post",data:param.data,async:!1,dataType:"json",success:function(response){return_data=response},error:function(e){console.log(e)}}),isReturn)return return_data}function confirm_swal(text,confirmBtnText){var isSuccess=!1;return new Promise((function(resolve,reject){Swal.fire({title:"Are you sure?",text:text,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:confirmBtnText}).then(result=>{result.value?resolve(!0):resolve(!1)})}))}function swal(content,response="success"){"success"==response?Swal.fire("Success",content,response):Swal.fire("Error",content,response)}function clearError(){$(".err").html("")}function input(element,value){$(element).val(value)}function customswal(msg){let timerInterval;Swal.fire({title:"Success!",html:"Will close in <b></b>",text:msg,type:"success",confirmButtonColor:"#3085d6",confirmButtonText:"Ok",allowOutsideClick:!1,allowEscapeKey:!1,timer:2e3,timerProgressBar:!0,didOpen:()=>{Swal.showLoading(),timerInterval=setInterval(()=>{const content=Swal.getHtmlContainer();if(content){const b=content.querySelector("b");b&&(b.textContent=(Swal.getTimerLeft()/1e3).toFixed(0))}},100)},willClose:()=>{clearInterval(timerInterval)}}).then(result=>{result&&location.reload()})}function imagePreview(e){output=document.getElementById("addProfile");var reader=new FileReader;reader.onload=function(){output.src=reader.result},reader.readAsDataURL(e.target.files[0])}function upImagePreview(e){output=document.getElementById("upProfile");var reader=new FileReader;reader.onload=function(){output.src=reader.result},reader.readAsDataURL(e.target.files[0])}$(document).ready((function(){var tbl_employees=$("#tbl_employees").DataTable({destroy:!0,processing:!0,serverSide:!0,responsive:!0,pageLength:50,order:[[1,"desc"]],columns:[{data:"employee_id",width:"6%",render:function(data,type,row,meta){var str="";return""!=row.profile_image?str+='<img src="'+base_url+row.profile_image+'" class="tableProfile" alt="Profile">':str+='<img src="'+base_url+'./assets/build/images/profile.png" class="tableProfile" alt="Profile">',str}},{data:"firstname",width:"20%"},{data:"lastname",width:"15%"},{data:"email",width:"15%"},{data:"phone",width:"15%"},{data:"employee_status",width:"10%",render:function(data,type,row,meta){var str="";return 1==row.employee_status?str+='<p class="btn btn-sm btn-outline-success">Enabled</p>':str+='<p class="btn btn-sm btn-outline-danger">Disabled</p>',str}},{data:"employee_id",width:"10%",render:function(data,type,row,meta){var str="";return str+='<a href="'+base_url+"employees/viewDocuments/"+row.employee_code+'" class="btn btn-sm btn-outline-info text-info viewDocBtn" title="Click to view Documents"><i class="fa fa-file-medical"></i></a>&nbsp;',1==row.employee_status?str+='<button data-id="'+row.employee_id+'" data-status="'+row.employee_status+'" class="btn btn-sm btn-outline-success updateEmployeeStatus" title="Click to Update Status"><i class="fa fa-lock-open"></i></button>&nbsp;':str+='<button data-id="'+row.employee_id+'" data-status="'+row.employee_status+'" class="btn btn-sm btn-outline-danger updateEmployeeStatus" title="Click to Update Status"><i class="fa fa-lock"></i></button>&nbsp;',str+='<button data-toggle="modal" data-target="#modal_updateEmployee" data-id="'+row.employee_id+'" class="btn btn-sm btn-outline-warning updateEmployee" title="Click to update"><i class="fa fa-edit"></i></button>&nbsp;',str+='<button data-id="'+row.employee_id+'" class="btn btn-sm btn-outline-danger removeEmployee" title="Click to remove"><i class="fa fa-times-circle"></i></button>'}}],language:{search:"",searchPlaceholder:"Search Employee...",infoFiltered:""},ajax:{url:base_url+"employees/getEmployees",type:"POST",beforeSend:function(){$(".tableLoad").show(),$(".all_contents").css({opacity:0})},complete:function(){$(".tableLoad").hide(),$(".all_contents").css({opacity:1})}},columnDefs:[{targets:[0,6],orderable:!1}]});if($(document).on("click",".addEmployee",(function(e){e.preventDefault(),clearError()})),$(".profilePic").change((function(e){for(var error_file="",files=$(".profilePic")[0].files,i=0;i<files.length;i++){var name,ext=$(this)[0].files[i].name.split(".").pop().toLowerCase(),oFReader;-1==jQuery.inArray(ext,["jpeg","jpg","png","gif"])&&(error_file+="<p>Invalid file type</p>"),(new FileReader).readAsDataURL($(this)[0].files[i]);var f=$(this)[0].files[i],fsize=f.size||f.fileSize;console.log(fsize),fsize>20871520&&(error_file+="<p> Image file size is too big to upload </p>")}if(""!=error_file)return ctr+=1,$(".profilePic").val(""),$(".profilePic").next(".err").html(error_file),!1;ctr=0,$(".profilePic").next(".err").html("")})),$(document).on("click","#addProfile",(function(){$("#profilePic").trigger("click")})),$(document).on("submit",".form_addEmployee",(function(e){e.preventDefault();var form_data=new FormData($(".form_addEmployee")[0]);form_data.append("profilePic",$("#profilePic")[0].files);var sendAjaxVar=sendAjax({url:base_url+"employees/addEmployee",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_addEmployee")[0].reset(),$("#addProfile").attr("src",base_url+"./assets/build/images/profile.png"),tbl_employees.ajax.reload(),$("#modal_addEmployee").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("click",".updateEmployee",(function(){var imgsrc="";employee_id=$(this).data("id");var data=sendAjax({url:base_url+"employees/getEmployeeInfo",data:{employee_id:employee_id}});$(".form_updateEmployee")[0].reset(),clearError(),input('input[name="upemployee_id"]',employee_id),input('input[name="upempfirstname"]',data.firstname),input('input[name="upemplastname"]',data.lastname),input('input[name="upempphone"]',data.phone),input('input[name="upempaddress"]',data.address),input('input[name="upempusername"]',data.username),input('input[name="upempemail"]',data.email),input('input[name="upprofile_image"]',data.profile_image),imgsrc=""!=data.profile_image?base_url+data.profile_image:base_url+"./assets/build/images/profile.png",$("#upProfile").attr("src",imgsrc),$(".form_addEmployee")[0].reset()})),$(document).on("submit",".form_updateEmployee",(function(e){e.preventDefault();var form_data=new FormData($(".form_updateEmployee")[0]);form_data.append("upProfilePic",$("#upProfilePic")[0].files);var sendAjaxVar=sendAjax({url:base_url+"employees/updateEmployee",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_updateEmployee")[0].reset(),tbl_employees.ajax.reload(),$("#modal_updateEmployee").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("click","#upProfile",(function(){$("#upProfilePic").trigger("click")})),$(document).on("click",".removeEmployee",(function(e){e.preventDefault();var employee_id=$(this).data("id");confirm_swal("Are you sure you want to remove this Employee?","Remove").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"employees/removeEmployee",data:{employee_id:employee_id}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_employees.ajax.reload())}}))})),$(document).on("click",".updateEmployeeStatus",(function(){var employee_id=$(this).data("id"),employee_status=$(this).data("status");1==employee_status?confirm_swal("Disable this Employee?","Disable").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"employees/updateEmployeeStatus",data:{employee_id:employee_id,employee_status:employee_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_employees.ajax.reload())}})):confirm_swal("Enable this Employee?","Enable").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"employees/updateEmployeeStatus",data:{employee_id:employee_id,employee_status:employee_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_employees.ajax.reload())}}))})),"viewDocuments"==method){var docEmployeeID=$('input[name="employee_id"]').val(),tbl_documents=$("#tbl_documents").DataTable({destroy:!0,processing:!0,serverSide:!0,responsive:!0,order:[[0,"desc"]],columns:[{data:"doc_name",width:"20%"},{data:"doc_type",width:"15%"},{data:"doc_status",width:"10%",render:function(data,type,row,meta){var str="";return 1==row.doc_status?str+='<span class="btn btn-outline-success">Verified</span>':str+='<span class="btn btn-outline-danger">Not Verified</span>',str}},{data:"date_added",width:"10%"},{data:"doc_id",width:"10%",render:function(data,type,row,meta){var str="";return str+='<a href="'+base_url+row.doc_path+'" target="_blank" class="btn btn-sm btn-outline-info"><i class="fa fa-eye"></i> View</a>&nbsp;',2==row.doc_status?str+='<button data-id="'+row.doc_id+'" data-status="'+row.doc_status+'" class="btn btn-sm btn-outline-success updateDocVerification" title="Click to Verify"><i class="fa fa-check"></i> Verify</button>&nbsp;':str+='<button data-id="'+row.doc_id+'" data-status="'+row.doc_status+'" class="btn btn-sm btn-outline-danger updateDocVerification" title="Click to Update Back as Not Verified"><i class="fa fa-times"></i> Unverify</button>&nbsp;',str+='<button data-id="'+row.doc_id+'" data-doc_path="'+row.doc_path+'" class="btn btn-sm btn-outline-danger removeDocument" title="Click to remove"><i class="fa fa-times-circle"></i></button>'}}],language:{search:"",searchPlaceholder:"Search Document...",infoFiltered:""},ajax:{url:base_url+"employees/getDocuments",type:"POST",data:{employee_id:docEmployeeID},beforeSend:function(){$(".tableLoad").show(),$(".all_contents").css({opacity:0})},complete:function(){$(".tableLoad").hide(),$(".all_contents").css({opacity:1})}},columnDefs:[{targets:[4],orderable:!1}]});$(".docfile").change((function(e){for(var error_file="",files=$(".docfile")[0].files,i=0;i<files.length;i++){var name,ext=$(this)[0].files[i].name.split(".").pop().toLowerCase(),oFReader;-1==jQuery.inArray(ext,["doc","docx","pdf","xls","xlsx","zip","jpeg","jpg","png"])&&(error_file+="<p>Invalid file type</p>"),(new FileReader).readAsDataURL($(this)[0].files[i]);var f=$(this)[0].files[i],fsize=f.size||f.fileSize;console.log(fsize),fsize>20871520&&(error_file+="<p> Document file size is too big to upload </p>")}if(""!=error_file)return ctr+=1,$(".docfile").val(""),$(".docfile").next(".err").html(error_file),!1;ctr=0,$(".docfile").next(".err").html("")})),$(document).on("submit",".form_addDocument",(function(e){e.preventDefault();var form_data=new FormData($(".form_addDocument")[0]);form_data.append("docfile",$("#docfile")[0].files);var sendAjaxVar=sendAjax({url:base_url+"employees/addDocument",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_addDocument")[0].reset(),tbl_documents.ajax.reload(),$("#modal_addDocument").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("click",".updateDocVerification",(function(){var doc_id=$(this).data("id"),doc_status=$(this).data("status");1==doc_status?confirm_swal("Unverify this Document?","Unverify").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"employees/updateDocumentStatus",data:{doc_id:doc_id,doc_status:doc_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_documents.ajax.reload())}})):confirm_swal("Verify this Document?","Verify").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"employees/updateDocumentStatus",data:{doc_id:doc_id,doc_status:doc_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_documents.ajax.reload())}}))})),$(document).on("click",".removeDocument",(function(e){e.preventDefault();var doc_id=$(this).data("id"),doc_path=$(this).data("doc_path");confirm_swal("Are you sure you want to remove this Document?","Remove").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"employees/removeDocument",data:{doc_id:doc_id,doc_path:doc_path}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),tbl_documents.ajax.reload())}}))}))}}));